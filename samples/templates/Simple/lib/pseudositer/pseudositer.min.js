((function(){var a=Array.prototype.slice;(function(b){var c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L;i=["startUpdate","doneUpdate","startLoading","failedLoading","doneLoading","alwaysLoading","destroyIndex","createIndex","selectLink","hideContent","showContent","showError","destroy"],d="pseudositer-content",K="pseudositer-stale",w="pseudositer-index",x="pseudositer-index-container",D="pseudositer-loading",h="pseudositer-error",z="pseudositer-link",G="pseudositer-link-selected",E=function(a){(typeof console!=="undefined"&&console!==null?console.log:void 0)!=null&&console.log(a);return},m=function(){var a;return a=document.location.pathname},l=function(){var a;return a=document.location.hash.substr(1)},q=function(a){var b,c,d,e;b=a.split("/"),d=["/"];for(c=1,e=b.length-1;1<=e?c<e:c>e;1<=e?c++:c--)d.push(b.slice(0,c+1||9e9).join("/")+"/");return d},r=function(a){return a.split("/").length-2},y=function(a){return this.logging&&E("isPathToFile( "+a+" )"),a.charAt(a.length-1)!=="/"?!0:!1},s=function(a){var b,c,d;return d=a.split("/"),b=d[d.length-1],c=b.split("."),c.length>1?c[c.length-1].toLowerCase():null},p=function(a){var b,c,d,e,f;b=a.attr("class").split(/\s+/);for(e=0,f=b.length;e<f;e++){c=b[e],d=c.match(new RegExp(""+w+"-(\\d)"));if(d!=null)return d[1]}throw"Could not find an index level in classes "+b},k=function(a){var c;return c=b("."+d),c.length===0&&(c=b("<div />").addClass(d).appendTo(a)),c},o=function(a){var c;return c=b("."+x),c.length===0&&(c=b("<div />").addClass(x).prependTo(a)),c},n=function(a){return w+"-"+a},j=function(a){return a.replace(/[^A-Za-z0-9]/g,"-")},c=function(a){var b,c,d;return y(a)?(d=a.split("/"),b=d[d.length-1].split("."),c=b.slice(0,b.length-1).join("."),d=d.slice(0,d.length-1),d.push(c),d.join("/")):a},L=function(a){var c;return c=b("."+z+'[href="#'+a+'"]'),c.siblings("."+z).removeClass(G),c.addClass(G)},B=function(a){var c,d,e;return d=b("<div />").css({height:"0px",width:"0px"}).appendTo(b("body")),e=new b.Deferred,c=b("<a />").attr("href",a).append(b("<img />").attr("src",a).bind("load",function(){return e.resolve(c),d.remove()}).bind("error",function(){return d.remove(),e.reject("Could not load image at "+a)})),e.promise()},C=function(a){var c;return c=new b.Deferred,b.get(a).done(function(a){return c.resolve(b("<div />").append(b("<pre />").text(a)))}).fail(function(a){return c.reject(a.statusText)}),c.promise()},A=function(a){var c;return c=new b.Deferred,b.get(a).done(function(a){return c.resolve(b(a))}).fail(function(a){return c.reject(a.statusText)}),c.promise()},g=function(a){return(new b.Deferred).resolve()},J=function(a,c){var d,e;this.logging&&E("showLoadingNotice( "+c+" )"),e=j(c),d=b("<div />").hide().text("Loading "+c+"...").addClass(""+D+" "+e).appendTo(this).fadeIn("fast");return},v=function(a,c){var d,e;this.logging&&E("hideLoadingNotice( "+c+" )"),c!=null?(e=j(c),d=b("."+D+"."+e)):d=b("."+D),d.fadeOut("fast",function(){return d.remove()});return},f=function(a,c,d){var e;this.logging&&E("destroyIndex( "+c+", "+d+" )"),e=(new b.Deferred).resolve(),b("."+w).each(function(a,c){var f,g;f=b(c);if(p(f)>d)return g=new b.Deferred(function(a){return f.fadeOut("fast",function(){return a.resolve()})}),e=e.pipe(function(){return g})}),e.done(function(){return c.resolve()});return},e=function(a,c,d,e){var f,g,h,i,j;this.logging&&E("createIndex( "+c+", "+d+", "+e+" )"),g=d.split("/").length-2,h=n(g),f=b("."+h),f.length===0&&(f=b("<div />").addClass(w+" "+h).hide(),o(this).append(f)),f.data("pseudositer")||f.data("pseudositer",{}),i=f.data("pseudositer").path,j=(new b.Deferred).done(function(){return f.fadeIn("fast",function(){return c.resolve()})}),d===i?j.resolve():f.fadeOut("fast",function(){return f.empty().data("pseudositer",{path:d}).append(e),j.resolve()});return},F=function(a,b,c,d){b.resolve();return},t=function(a,b){var c;this.logging&&E("hideContent( "+b+" )"),c=k(this).children(),c.length===0?b.resolve():c.fadeOut("fast",function(){return c.detach(),b.resolve()});return},H=function(a,b,c){var d;this.logging&&E("showContent( "+b+", "+c+" )"),d=k(this),c.hide().appendTo(d).fadeIn("fast",function(){return b.resolve()});return},I=function(a,c){var d;this.logging&&E("showError( "+c+" )"),this.logging&&E(c),d=b("."+h),d.length===0&&(d=b("<div />").addClass(h).appendTo(k(this))),d.text(c.toString()).fadeIn("fast");return},u=function(a){var c;this.logging&&E("hideError( )"),c=b("."+h),c.fadeOut("fast",function(){return c.text("")});return},b.pseudositer=function(d,e,f){var g,h,j,k,n,o,p,t,u=this;return this.$el=b(d),this.$el.data("pseudositer",this),this.cache={},this.init=function(){var c,d,g,h,j,k,l,n;u.options=b.extend({},b.pseudositer.defaultOptions,f),u.map=b.extend({},b.pseudositer.defaultMap,u.options.map),u.visiblePath=m(),u.logging=u.options.logging,u.updating=(new b.Deferred).resolve().promise(),e.charAt(e.length-1)||(e=""+e+"/"),e.charAt(0)==="/"?u.realPath=e:s(u.visiblePath)!=null?(g=u.visiblePath.split("/"),u.realPath=g.slice(0,g.length-1).join("/")+"/"+e):u.visiblePath.charAt(u.visiblePath.length-1)==="/"?u.realPath=u.visiblePath+e:u.realPath=u.visiblePath+"/"+e,b(window).bind("hashchange",t);for(h=0,k=i.length;h<k;h++){c=i[h],n=u.options[c];for(j=0,l=n.length;j<l;j++)d=n[j],u.$el.bind(""+c+".pseudositer",{handler:d},function(){var b,c;return b=1<=arguments.length?a.call(arguments,0):[],c=b[0],c.data.handler.apply(u.$el,b),!1})}return t(),u},this.setRecursion=function(a){u.logging&&E("setRecursion( "+a+" )");if(a!==!0&&a!==!1||u.options.recursion===a)throw"new value for recursion must be true or false";return u.options.recursion=a,t(),u},this.destroy=function(){return u.logging&&E("destroy( )"),b(window).unbind("hashchange",t),u.$el.empty(),u.$el.removeData("pseudositer"),document.location.hash="",p("destroy"),u.$el.unbind(".pseudositer"),u},p=function(){var b,c;return c=arguments[0],b=2<=arguments.length?a.call(arguments,1):[],u.logging&&E("trigger( "+c+", "+b+" )"),u.$el.triggerHandler(""+c+".pseudositer",b),u},g=function(a){return u.logging&&E("getAjaxPath( "+a+" )"),u.realPath+a.substr(1)},t=function(){var a,c;u.logging&&E("update( )"),a=l();if(a===""){document.location.hash="/";return}if(a.charAt(0)!=="/"){document.location.hash="/"+a;return}if(u.options.recursion===!0&&y(a)!==!0){n(a);return}return p("startUpdate",a,g(a)),c=(new b.Deferred).done(function(){return p("doneUpdate",a,g(a))}).fail(function(a){return p("showError",a)}),u.updating.always(function(){var d;return u.updating=c.promise(),u.cache[a]!=null?d=(new b.Deferred).resolve():d=h(a),setTimeout(function(){return c.reject("Load timeout after "+u.options.timeout+" ms")},u.options.timeout),d.fail(function(a){return c.reject(a)}).done(function(){var d,e;return e=o(a),d=new b.Deferred,p("hideContent",d),b.when(e,d).done(function(){var d,e,f;return y(a)?(f=new b.Deferred,p("selectLink",f,a,L(a)),d=u.cache[a],e=(new b.Deferred).done(function(){return c.resolve()}).fail(function(a){return c.reject(a)}),f.done(function(){return p("showContent",e,d)})):c.resolve()}).fail(function(a){return c.reject(a)})})}),u},h=function(a){var c,d,e,f,g,h,i;u.logging&&E("load( "+a+" )"),p("startLoading",a),d=[],y(a)&&d.push(j(a)),f=q(a),i=f.slice(0,f.length-1+1||9e9);for(g=0,h=i.length;g<h;g++)e=i[g],d.push(k(e));return c=b.when.apply(u,d).done(function(){return p("doneLoading",a)}).fail(function(b){return p("failedLoading",a)}).always(function(){return p("alwaysLoading",a)})},n=function(a){return u.logging&&E("redirectToFile( "+a+" )"),y(a)?document.location.hash=a:k(a).done(function(){var b;return b=u.cache[a],b.length===0?p("showError",""+a+" has no content"):n(b.first().attr("href").substr(1))}).fail(function(a){return p("showError",a)}),u},k=function(a){var d;return u.logging&&E("loadIndex( "+a+" )"),d=new b.Deferred,u.cache[a]!=null?d.resolve():b.getJSON(g(a+u.options.indexFileName),function(e){var f,g,h,i;return h=u.options.showExtension,i=u.options.stripSlashes,g=u.options.decodeUri,f=b("<div />"),b.each(e,function(){var d,e,j;return this.charAt(0)==="/"?g===!0?e="#"+decodeURI(this):e="#"+this:g===!0?e="#"+decodeURI(a+this):e="#"+a+this,h===!1&&(j=c(this)),i===!0&&this.substr(this.length-1)==="/"&&(j=this.substr(0,this.length-1)),d=b("<a />").attr("href",e).addClass(z).text(j).appendTo(f)}),u.cache[a]=f.children(),d.resolve()}).fail(function(){return d.reject("Could not load index page for "+a)}),d.promise()},j=function(a){var c,d,e,f;return u.logging&&E("loadContent( "+a+" )"),f=s(a),d=new b.Deferred,c=u.map[f]!=null?u.map[f]:u.map[""],e=c(g(a)),e.done(function(b){return u.cache[a]=b,d.resolve()}).fail(function(a){return d.reject(a)}),d.promise()},o=function(a){var c,d,e;return u.logging&&E("showIndices( "+a+" )"),c=new b.Deferred,p("destroyIndex",c,r(a)),e=q(a),d=[c.promise()],b.each(e,function(a,c){var e,f,g,h;return e=u.cache[c],g=d[d.length-1],f=new b.Deferred,h=new b.Deferred,g.done(function(){return p("selectLink",h,c,L(c))}),h.done(function(){return p("createIndex",f,c,e)}),d.push(f.promise())}),d[d.length-1]},this.init()},b.pseudositer.defaultOptions={linkSelector:'a:not([href^="?"],[href^="/"],[href^="../"])',startUpdate:[u],doneUpdate:[],startLoading:[J],failedLoading:[],doneLoading:[],alwaysLoading:[v],destroyIndex:[f],createIndex:[e],selectLink:[F],hideContent:[t],showContent:[H],showError:[I],destroy:[v,u],logging:!1,timeout:1e4,recursion:!1,showExtension:!1,decodeUri:!1,stripSlashes:!1,indexFileName:"index.json"},b.pseudositer.defaultMap={png:B,gif:B,jpg:B,jpeg:B,txt:C,html:A,"":g},b.fn.pseudositer=function(a,c){return b.each(this,function(d,e){var f;f=b(e);if(!f.data("pseudositer"))return f.data("pseudositer",new b.pseudositer(e,a,c))})};return})(jQuery)})).call(this);