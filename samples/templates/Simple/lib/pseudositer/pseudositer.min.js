((function(){var a=Array.prototype.slice;(function(b){var c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M;g=["startUpdate","doneUpdate","startLoading","failedLoading","doneLoading","alwaysLoading","hideIndex","showIndex","selectLink","hideContent","showContent","showError","destroy"],d="pseudositer-content",K="pseudositer-stale",v="pseudositer-index",w="pseudositer-index-container",C="pseudositer-loading",f="pseudositer-error",y="pseudositer-link",F="pseudositer-link-selected",D=function(a){(typeof console!=="undefined"&&console!==null?console.log:void 0)!=null&&console.log(a);return},k=function(){var a;return a=document.location.pathname},j=function(){var a;return a=document.location.hash.substr(1)},o=function(a){var b,c,d,e;b=a.split("/"),d=["/"];for(c=1,e=b.length-1;1<=e?c<e:c>e;1<=e?c++:c--)d.push(b.slice(0,c+1||9e9).join("/")+"/");return d},p=function(a){return a.split("/").length-2},x=function(a){return this.logging&&D("isPathToFile( "+a+" )"),a.charAt(a.length-1)!=="/"?!0:!1},q=function(a){var b,c,d;return d=a.split("/"),b=d[d.length-1],c=b.split("."),c.length>1?c[c.length-1].toLowerCase():null},n=function(a){var b,c,d,e,f;b=a.attr("class").split(/\s+/);for(e=0,f=b.length;e<f;e++){c=b[e],d=c.match(new RegExp(""+v+"-(\\d)"));if(d!=null)return d[1]}throw"Could not find an index level in classes "+b},i=function(a){var c;return c=b("."+d),c.length===0&&(c=b("<div />").addClass(d).appendTo(a)),c},m=function(a){var c;return c=b("."+w),c.length===0&&(c=b("<div />").addClass(w).prependTo(a)),c},l=function(a){return v+"-"+a},h=function(a){return a.replace(/[^A-Za-z0-9]/g,"-")},c=function(a){var b,c,d;return x(a)?(d=a.split("/"),b=d[d.length-1].split("."),c=b.slice(0,b.length-1).join("."),d=d.slice(0,d.length-1),d.push(c),d.join("/")):a},M=function(a){var c;return c=b("."+y+'[href="#'+a+'"]'),c.siblings("."+y).removeClass(F),c.addClass(F)},A=function(a){var c,d,e;return d=b("<div />").css({height:"0px",width:"0px"}).appendTo(b("body")),e=new b.Deferred,c=b("<a />").attr("href",a).append(b("<img />").attr("src",a).bind("load",function(){return e.resolve(c),d.remove()}).bind("error",function(){return d.remove(),e.reject("Could not load image at "+a)})),e.promise()},B=function(a){var c;return c=new b.Deferred,b.get(a).done(function(a){return c.resolve(b("<div />").append(b("<pre />").text(a)))}).fail(function(a){return c.reject(a.statusText)}),c.promise()},z=function(a){var c;return c=new b.Deferred,b.get(a).done(function(a){return c.resolve(b(a))}).fail(function(a){return c.reject(a.statusText)}),c.promise()},e=function(a){return window.location=a,(new b.Deferred).resolve()},L=function(a,c){var d,e;return e=l(a),d=b("<ul />").addClass(v+" "+e).hide(),c.each(function(){return d.append(b("<li />").append(this))}),d},J=function(a,c){var d,e;this.logging&&D("showLoadingNotice( "+c+" )"),e=h(c),d=b("<div />").hide().text("Loading "+c+"...").addClass(""+C+" "+e).appendTo(this).fadeIn("fast");return},u=function(a,c){var d,e;this.logging&&D("hideLoadingNotice( "+c+" )"),c!=null?(e=h(c),d=b("."+C+"."+e)):d=b("."+C),d.fadeOut("fast",function(){return d.remove()});return},t=function(a,c,d){var e,f,g,h,i;this.logging&&D("hideIndex( "+c+", "+d+" )"),h=(new b.Deferred).resolve(),i=o(d),g=b("."+y+'[href="#'+d+'"]'),e=g.parents("li").siblings().find("."+v),f=g.siblings("."+v).find("."+v),D(g),D(e),D(f),b.merge(e,f).each(function(){var a,c;return a=b(this),c=new b.Deferred(function(b){return a.fadeOut("fast",function(){return b.resolve()})}),h=h.pipe(function(){return c})}),h.done(function(){return c.resolve()});return},I=function(a,c,d,e){var f,g,h;this.logging&&D("showIndex( "+c+", "+d+", "+e+" )"),h=d.split("/").length-2,h===0?(f=b("."+l(0)),f.length===0&&(f=L(h,e).appendTo(m(this)))):(g=b('a[href="#'+d+'"]'),f=g.siblings("."+v),f.length===0&&(f=L(h,e),g.after(f))),f.is(":visible")?c.resolve():f.fadeIn("fast",function(){return c.resolve()});return},E=function(a,b,c,d){b.resolve();return},r=function(a,b){var c;this.logging&&D("hideContent( "+b+" )"),c=i(this).children(),c.length===0?b.resolve():c.fadeOut("fast",function(){return c.detach(),b.resolve()});return},G=function(a,b,c){var d;this.logging&&D("showContent( "+b+", "+c+" )"),d=i(this),c.hide().appendTo(d).fadeIn("fast",function(){return b.resolve()});return},H=function(a,c){var d;this.logging&&D("showError( "+c+" )"),this.logging&&D(c),d=b("."+f),d.length===0&&(d=b("<div />").addClass(f).appendTo(i(this))),d.text(c.toString()).fadeIn("fast");return},s=function(a){var c;this.logging&&D("hideError( )"),c=b("."+f),c.fadeOut("fast",function(){return c.text("")});return},b.pseudositer=function(d,e,f){var h,i,l,m,n,p,r,s,t=this;return this.$el=b(d),this.$el.data("pseudositer",this),this.cache={},this.init=function(){var c,d,h,i,j,l,m,n;t.options=b.extend({},b.pseudositer.defaultOptions,f),t.map=b.extend({},b.pseudositer.defaultMap,t.options.map),t.visiblePath=k(),t.logging=t.options.logging,t.updating=(new b.Deferred).resolve().promise(),e.charAt(e.length-1)||(e=""+e+"/"),e.charAt(0)==="/"?t.realPath=e:q(t.visiblePath)!=null?(h=t.visiblePath.split("/"),t.realPath=h.slice(0,h.length-1).join("/")+"/"+e):t.visiblePath.charAt(t.visiblePath.length-1)==="/"?t.realPath=t.visiblePath+e:t.realPath=t.visiblePath+"/"+e,b(window).bind("hashchange",s);for(i=0,l=g.length;i<l;i++){c=g[i],n=t.options[c];for(j=0,m=n.length;j<m;j++)d=n[j],t.$el.bind(""+c+".pseudositer",{handler:d},function(){var b,c;return b=1<=arguments.length?a.call(arguments,0):[],c=b[0],c.data.handler.apply(t.$el,b),!1})}return s(),t},this.setRecursion=function(a){t.logging&&D("setRecursion( "+a+" )");if(a!==!0&&a!==!1||t.options.recursion===a)throw"new value for recursion must be true or false";return t.options.recursion=a,s(),t},this.destroy=function(){return t.logging&&D("destroy( )"),b(window).unbind("hashchange",s),t.$el.empty(),t.$el.removeData("pseudositer"),document.location.hash="",r("destroy"),t.$el.unbind(".pseudositer"),t},r=function(){var b,c;return c=arguments[0],b=2<=arguments.length?a.call(arguments,1):[],t.logging&&D("trigger( "+c+", "+b+" )"),t.$el.triggerHandler(""+c+".pseudositer",b),t},h=function(a){return t.logging&&D("getAjaxPath( "+a+" )"),t.realPath+a.substr(1)},s=function(){var a,c;t.logging&&D("update( )"),a=j();if(a===""){document.location.hash="/";return}if(a.charAt(0)!=="/"){document.location.hash="/"+a;return}if(t.options.recursion===!0&&x(a)!==!0){n(a);return}return r("startUpdate",a,h(a)),c=(new b.Deferred).done(function(){return r("doneUpdate",a,h(a))}).fail(function(a){return r("showError",a)}),t.updating.always(function(){var d;return t.updating=c.promise(),t.cache[a]!=null?d=(new b.Deferred).resolve():d=i(a),setTimeout(function(){return c.reject("Load timeout after "+t.options.timeout+" ms")},t.options.timeout),d.fail(function(a){return c.reject(a)}).done(function(){var d,e;return e=p(a),d=new b.Deferred,r("hideContent",d),b.when(e,d).done(function(){var d,e,f;return x(a)?(f=new b.Deferred,r("selectLink",f,a,M(a)),d=t.cache[a],e=(new b.Deferred).done(function(){return c.resolve()}).fail(function(a){return c.reject(a)}),f.done(function(){return r("showContent",e,d)})):c.resolve()}).fail(function(a){return c.reject(a)})})}),t},i=function(a){var c,d,e,f,g,h,i;t.logging&&D("load( "+a+" )"),r("startLoading",a),d=[],x(a)&&d.push(l(a)),f=o(a),i=f.slice(0,f.length-1+1||9e9);for(g=0,h=i.length;g<h;g++)e=i[g],d.push(m(e));return c=b.when.apply(t,d).done(function(){return r("doneLoading",a)}).fail(function(b){return r("failedLoading",a)}).always(function(){return r("alwaysLoading",a)})},n=function(a){return t.logging&&D("redirectToFile( "+a+" )"),x(a)?document.location.hash=a:m(a).done(function(){var b;return b=t.cache[a],b.length===0?r("showError",""+a+" has no content"):n(b.first().attr("href").substr(1))}).fail(function(a){return r("showError",a)}),t},m=function(a){var d;return t.logging&&D("loadIndex( "+a+" )"),d=new b.Deferred,t.cache[a]!=null?d.resolve():b.get(h(a),function(e){var f,g,h;return g=t.options.showExtension,h=t.options.stripSlashes,f=b(e).find(t.options.linkSelector).addClass(y).text(function(a,d){var e;return e=decodeURI(b(this).attr("href")),g===!1&&(e=c(e)),h===!0&&e.substr(e.length-1)==="/"&&(e=e.substr(0,e.length-1)),e}).attr("href",function(b,c){return c.charAt(0)==="/"?t.options.decodeUri===!0?"#"+decodeURI(c):"#"+c:t.options.decodeUri===!0?"#"+decodeURI(a+c):"#"+a+c}),t.cache[a]=f,d.resolve()}).fail(function(){return d.reject("Could not load index page for "+a)}),d.promise()},l=function(a){var c,d,e,f;return t.logging&&D("loadContent( "+a+" )"),f=q(a),d=new b.Deferred,c=t.map[f]!=null?t.map[f]:t.map[""],e=c(h(a)),e.done(function(b){return t.cache[a]=b,d.resolve()}).fail(function(a){return d.reject(a)}),d.promise()},p=function(a){var c,d,e;return t.logging&&D("showIndices( "+a+" )"),c=new b.Deferred,r("hideIndex",c,a),e=o(a),d=[c.promise()],b.each(e,function(a,c){var e,f,g,h;return e=t.cache[c],g=d[d.length-1],f=new b.Deferred,h=new b.Deferred,g.done(function(){return r("selectLink",h,c,M(c))}),h.done(function(){return r("showIndex",f,c,e)}),d.push(f.promise())}),d[d.length-1]},this.init()},b.pseudositer.defaultOptions={linkSelector:'a:not([href^="?"],[href^="/"],[href^="../"])',startUpdate:[s],doneUpdate:[],startLoading:[J],failedLoading:[],doneLoading:[],alwaysLoading:[u],hideIndex:[t],showIndex:[I],selectLink:[E],hideContent:[r],showContent:[G],showError:[H],destroy:[u,s],logging:!1,timeout:1e4,recursion:!1,showExtension:!1,decodeUri:!1,stripSlashes:!1},b.pseudositer.defaultMap={png:A,gif:A,jpg:A,jpeg:A,txt:B,html:z,"":e},b.fn.pseudositer=function(a,c){return b.each(this,function(d,e){var f;f=b(e);if(!f.data("pseudositer"))return f.data("pseudositer",new b.pseudositer(e,a,c))})};return})(jQuery)})).call(this);